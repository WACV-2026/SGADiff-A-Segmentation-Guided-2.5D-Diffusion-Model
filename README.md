# SGADiff: A Segmentation-Guided 2.5D Diffusion Model for CT Volume Generation from Synthesized Aorta Meshes

<div align='center'>
<img src='pipeline.png'>
</div>

## Introduction
**SGADiff** (Segmentation-Guided 2.5D Diffusion) is a framework for synthesizing realistic **3D aortic CT volumes** from synthetic aorta meshes.  
It addresses the scarcity of pathological imaging data (e.g., aneurysms, coarctations) by enabling controllable generation of both healthy and diseased CT scans.  

The pipeline has two main stages:
1. **Anatomical Priors** â€“ Diverse aorta meshes are generated by **HUG-VAS** and voxelized into segmentation masks, explicitly encoding anatomical structures.  
2. **Segmentation-Guided Diffusion** â€“ A **2.5D diffusion model** is trained to synthesize CT slices conditioned on masks. An imputation + sliding-window strategy ensures smooth continuity across axial slices during inference.  

SGADiff supports creating large-scale paired datasets (mesh, mask, CT) for **model training, validation, and clinical research**.

---

## Features
- ðŸ«€ **Segmentation-Guided Conditioning**: Generates CT volumes directly from anatomical priors.  
- ðŸ–¼ **2.5D Diffusion**: Trains efficiently while preserving axial continuity.  
- ðŸ”€ **Controllable Pathology Generation**: Healthy â†’ Aneurysmal / Coarcted variants.  
- ðŸ“Š **Dataset Utility**: Outputs paired mesh, segmentation, and CT volumes for downstream tasks.  
- âš¡ **Lightweight Training**: 2.5D diffusion requires significantly less GPU memory than full 3D diffusion.  

---

## Installation
We recommend using **conda** for environment setup.

Key dependencies (see requirements.txt):
'''python
PyTorch
 >= 2.1

MONAI
 >= 1.4

Diffusers
 >= 0.21

SimpleITK, PyVista, tqdm, matplotlib

Dataset Preparation

SGADiff expects data in NRRD format.
Use split_data.py to structure datasets into train/val/test:

```bash
git clone https://github.com/<your-username>/SGADiff.git
cd SGADiff

# Create environment
conda create -n sgadiff python=3.10
conda activate sgadiff

# Install dependencies
pip install -r requirements.txt

## Introduction
> SGADiff (Segmentation-Guided 2.5D Diffusion) is a novel framework for synthesizing realistic 3D aortic CT volumes from synthetic aorta meshes.
The pipeline operates in two stages:

> 1. Anatomical Priors â€“ Diverse aorta meshes are generated by HUG-VAS and voxelized into segmentation masks, providing explicit structural guidance.

> 2. Segmentation-Guided Diffusion â€“ A 2.5D diffusion model is trained to generate CT slices conditioned on these masks. During inference, an imputation and sliding-window strategy ensures smooth axial continuity across slices.

> SGADiff enables controllable synthesis of healthy and pathological cases (e.g., aneurysms, coarctations), addressing the scarcity of pathological imaging data. The generated volumes can be organized into datasets for downstream research, model training, and clinical applications.

---
## Architecture overview of SurfPatch
> SurfPatch is for analyzing surfaces through a three-stage process: (1) classifying vertices based on heat kernel signature (HKS) features and partitioning the surface into fine-grained patches using agglomerative hierarchical clustering (AHC) with connectivity constraints, (2) matching similar patches within or across surfaces by aggregating vertex-level features into patch-level features, and (3) clustering surfaces by further aggregating patch-level features into surface-level features, enabling efficient querying and exploration of patches and surfaces.
<div align='center'>
<img src='framework.png'>
</div>

## Installation
The code is developed by Python. After cloning the repository, follow the steps below for installation:
1. Create and activate the conda environment
```python
conda create --name surfpatch python=3.10
conda activate surfpatch
```
2. Install dependencies
```python
pip install -r requirements.txt
```
3. Run the interface
```python
python main.py
```

## Dataset
SurfPatch could handle stream surfaces generated from steady and unsteady flows and isosurfaces extracted from scalar fields. The dataset folder for surfaces should be organized as follows:
```
./dataset/
|
â”œâ”€â”€ data/
â”œâ”€â”€ gallery/
â”œâ”€â”€ hks_feature/
â”œâ”€â”€ patch/
â”‚   â””â”€â”€ level1/
â””â”€â”€ project2d/
    â””â”€â”€ level1/
```
We provide a subset of the [Two Swirls dataset](https://drive.google.com/drive/folders/1-PPu12Ls-kHmZtfqaNW3rfJ199-R4bpg?usp=drive_link) as an example for testing our method.












